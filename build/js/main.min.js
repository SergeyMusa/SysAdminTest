// <!-- проверка ввода имени -->

// отключаем поля ввода пока не нажат чекбокс
let checkboxClick = document.querySelector("#flexSwitchCheckDefault");

const disableButton = () => {
  // alert( 'чекбокс выключён1' );
  userOrg.disabled = true;
  userName.disabled = true;
  userButton.disabled = true;
  document.getElementById('autorization').hidden = false;


  if (checkboxClick.checked) {
    // alert( 'чекбокс включён' );
    userName.disabled = false;
    userOrg.disabled = false;
    userButton.disabled = false;
    // autorization.dis = false;
    document.getElementById('autorization').hidden = true;

  }
};
// ------

// выбираем имя по умолчанию если не введено что-то другое и заносим в локал сторадж
const userFunction = () => {
  // alert( 'чекбокс выключён1' );
  let user = userName.placeholder;
  let org = userOrg.placeholder;

  if (userName.value !== "" && userOrg.value !== "") {
    // userName.placeholder = "Сыкло )";
    user = `"${userName.value}"`;
    org = `"${userOrg.value}"`;
  }
  // console.log(`userButton click ${user} ${org} `);

  localStorage.setItem('user', user);
  localStorage.setItem('org', org);

  console.log(
    localStorage.getItem('user') + ' ' + localStorage.getItem('org')
  );
  userButton.disabled = true;
  userButtonTest.disabled = false;

  flexSwitchCheckDefault.disabled = true;
};


const iqFunction = () => {
    const htmlElement = document.documentElement;
    const firstChildNodeH = htmlElement.firstChild;
    const lastChildNodeH = htmlElement.lastChild;
    console.log("htmlElement___" + htmlElement);
    console.log("firstChildNodeH" + firstChildNodeH);
    console.log("lastChildNodeH" + lastChildNodeH);

    const headElement = document.head;
    const firstChildNodeHd = headElement.firstChild;
    const lastChildNodeHd = headElement.lastChild;
    console.log("headElement______" + headElement);
    console.log("firstChildNodeHd" + firstChildNodeHd);
    console.log("lastChildNodeHd" + lastChildNodeHd);

    const bodyElement = document.body;
    const firstChildNodeB = bodyElement.firstChild;
    const lastChildNodeB = bodyElement.lastChild;
    console.log("bodyElement__________" + bodyElement);
    console.log("firstChildNodeB" + firstChildNodeB);
    console.log("lastChildNodeB" + lastChildNodeB);
    // return 'index'
}
// формируем тест

// const doTest = () => {
const header = document.querySelector("header");
const section = document.querySelector("section");
const questionsNumber = 2;
userButtonTest.disabled = false;
const answerList = {};

let requestURL = "./json/test.json";
let request = new XMLHttpRequest();

request.open("GET", requestURL);
request.responseType = "json";
request.send();
let sysAdminTest

request.onload = function () {
    sysAdminTest = request.response;
    populateHeader(sysAdminTest);
    showTest(sysAdminTest);
    testCount(sysAdminTest);
    setTimeout(() => {
        console.log(Object.keys(answerList).length);
    }, 5000)
};




function populateHeader(obj) {
    const myH1 = document.createElement("h1");
    myH1.textContent = obj["jTestSysadmin"];
    header.appendChild(myH1);


    const user = document.createElement("p");
    "Тест проходит: " +
        obj["intervieweeName"] +
        " из организации: " +
        obj["intervieweeOrg"];
    // user.textContent = 'Тест проходит: ' + localStorage.getItem('user') + ' из организации: ' + localStorage.getItem('org');
    //- let intervieweeName = user.textContent =localStorage.getItem('user');
    //- let intervieweeOrg = user.textContent =localStorage.getItem('org');
    header.appendChild(user);


}

function showTest(obj) {
    const questions = obj["survey"];

    for (let i = 0; i < questions.length; i++) {
        // console.log(questions.length);
        const myArticle = document.createElement("article");
        const testNumber = document.createElement("h2");
        const testQuestion = document.createElement("p");
        const testVariants = document.createElement("p");
        const testAnswer = document.createElement("p");

        // const myList = document.createElement("ul");

        myArticle.setAttribute("class", "test3");

        testNumber.textContent = questions[i].numberTest;
        testQuestion.textContent = "Вопрос: " + questions[i].question;
        testVariants.textContent = "Варианты ответов: " + questions[i].answers;
        testAnswer.textContent =
            "Правильный ответ: " +
            questions[i].right +
            " - " +
            questions[i].justification;

        const radioAnswerList = document.createElement("div");

        const variantAnsver = questions[i].answers;
        for (let j = 0; j < variantAnsver.length; j++) {
            // const listItem = document.createElement("li");
            const radioAnswer = document.createElement("div");

            radioAnswer.innerHTML =
                `<input type='radio' name='answer${i}' value='${j}' onClick='onChangeButtonValue(${i},${j})'> <label for='${j}'>${variantAnsver[j]}</label>`;
            // const listItem = document.createElement("radio");
            // listItem.textContent = variantAnsver[j];
            // radioAnswer.appendChild(listItem);
            radioAnswerList.appendChild(radioAnswer)
        }

        myArticle.appendChild(testNumber);
        myArticle.appendChild(testQuestion);
        //
        myArticle.appendChild(radioAnswerList);

        myArticle.appendChild(testAnswer);
        // ответ
        section.appendChild(myArticle);
        // myArticle.appendChild(myPara2);
    }
}

function onChangeButtonValue(num, value) {
    answerList[num] = value;
}


function checkTest() {
    //<input type="radio" name="answer0" value="0">
    // function question1()
    let selectedAns = 0;
    let questions;

    const answerListTrue = {}

    sysAdminTest["survey"].map(item => {
        answerListTrue[item.numberTest] = item.right;
    })

    console.log('answerList: ', answerList, 'answerListTrue: ', answerListTrue);


    // console.log(sysAdminTest["survey"]);
    for (var j = 0; j < questionsNumber; j++) {
        // console.log("j- " + j);

        let answerNumber = (`answer${j}`);
        // console.log(typeof (answerNumber) + answerNumber);
        // console.log(answerNumber);
        //!!!!!!!!!!!!!!!!!!!!! строка работает а переменная нет
        questions += document.getElementsByName(answerNumber)

        // console.log(`questions=` + questions);

        for (var i = 0; i < questions.length; i++) {
            // console.log("questions.length " + questions.length);

            if (questions[i].checked == true) {
                selectedAns = questions[i].value;
                console.log("value " + selectedAns);
                break;
            }

            // if (selectedAns == '1') {
            //     console.log("That the correct answer!");
            //     console.log("value " + selectedAns);
            //     //  break;
            // }
            // else {
            //     console.log("Oops! try again!");
            //     console.log("value " + selectedAns);
            //     //    break;
            // }
        };
    };
};
const testCount = () => {
    let count = Number(localStorage.getItem('count')) || 0;
    // console.log("count_= " + count);
    count = count + 1;
    // !!!!!!!!! исправить костыль
    localStorage.setItem('count', count);
    // console.log("count= " + localStorage.getItem('count'));
};

//
// правильные ответы можно выводить все вместе внизу
// потом сделать - перерисовать тест с выделением правильный

const doDelete = () => {
    // localStorage.removeItem('count');
    localStorage.setItem('count', 0);

    console.log("count= " + localStorage.getItem('count'));
}

// }